---
# To run: `ansible-playbook chain-operator-files.yml`
- name: Chain operator files together for easy deployment.
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    - name: Template CRD
      template:
        src: crd.yml.j2
        dest: "{{ playbook_dir }}/../deploy/crds/awx_v1beta1_crd.yaml"

    - name: Template awx-operator.yaml
      copy:
        content: |
          # This file is generated by Ansible. Changes will be lost.
          # Update templates under ansible/templates/
          {{ lookup('template', 'role.yml.j2') }}
          {{ lookup('template', 'role_binding.yml.j2') }}
          {{ lookup('template', 'service_account.yml.j2') }}
          {{ lookup('template', 'operator.yml.j2') }}
          {{ lookup('template', 'crd.yml.j2') }}
        dest: ../deploy/awx-operator.yaml
